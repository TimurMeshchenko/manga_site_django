{% extends "signin.html" %}
{% load static %}

{% block title %}
  <title>Восстановление пароля</title>
{% endblock %}

{% block body %}
  <div
    class="Dialog_paper__JNmkA Dialog_paperWidth-xs__LpPEM Dialog_paper-scroll-paper__3WvVF rounded"
    style="
          display: flex;
          justify-content: center;
          align-items: center;
          height: 100%;
          width: 100%;
          flex-direction: column;
      ">
    <div class="jsx-4c4906b68fb5f50a container">
      <h5
        class="Typography_h5__8pAxj Typography_color-textSecondary__iFFB7 Typography_gutterBottom__Q_9Ve Typography_align-left___WQEo"
        style="font-size: 1.1rem;">
        Восстановить пароль</h5>
  <form method="post">
    {% csrf_token %}
    <div class="jsx-261496919888b024 root fullWidth Input_formControl__B11lU">
      <div class="Input_root___0KQ3 Input_outlined__GjuSL"><input aria-invalid="false" name="password1"
          placeholder="*Пароль" rows="1" type="password" class="Input_input___YBKm" value="" autocomplete="new-password"
          required="" id="id_password1" /></div>
      <p class="Input_formHelperText__EwCsr"></p>
    </div>
    <div class="jsx-261496919888b024 root fullWidth Input_formControl__B11lU">
      <div class="Input_root___0KQ3 Input_outlined__GjuSL"><input aria-invalid="false" name="password2"
          placeholder="*Пароль еще раз" rows="1" type="password" class="Input_input___YBKm" value=""
          autocomplete="new-password" required="" id="id_password2" /></div>
      <p class="Input_formHelperText__EwCsr"></p>
    </div>

    <button
      class="Button_button___CisL Button_button___CisL Button_contained__8_KFk Button_contained-primary__IViyX Button_contained-size-large__HCqRj Button_fullWidth__Dgoqh"
      tabindex="0" type="submit"><span class="Button_label__jamx3">Восстановить пароль</span>
    </button>
  </form>

  <p class="exceptions" style="color: red;"></p>
  </div>  
  </div>
  </div>
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script src="{% static 'title/js/ajax/ajax_post.js' %}"></script>
  <script>
    const reset_password_form = "form";
    const exceptions_element = document.querySelector(".exceptions");
    const ajax_post = new Ajax_post();

    const update_data_callback = (data) => {
      const is_error = 'detail' in data;

      if (is_error) {
        const errors = data['detail'];

        exceptions_element.innerHTML = '';

        for (const [key, value] of Object.entries(errors))
          exceptions_element.innerHTML = value[0];
      }
      else
        window.location.href = "/manga";
    }

    ajax_post.Form_submit(reset_password_form, "reset_password", update_data_callback);
  </script>


{% endblock %}
